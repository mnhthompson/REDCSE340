

<% if (title) { %>
    <h1><%= title %></h1>
    <% } else {res.redirect('/')} %>
<%- listing %>


<section id="reviews" class="container mt-5">
  <h2>Reviews (<%= Array.isArray(reviews) ? reviews.length : 0 %>)</h2>

  <% if (Array.isArray(reviews) && reviews.length > 0) { %>
    <% reviews.forEach(r => { %>
      <article class="review card mb-3 p-3">
        <div class="review-meta small text-muted">
          <strong><%= r.account_firstname ? r.account_firstname.charAt(0) : '' %><%= r.account_lastname ? r.account_lastname.replace(/\s+/g,'') : '' %></strong>
          â€” <%= r.review_date ? r.review_date : '' %>
        </div>
        <div class="review-text mt-2"><%= r.review_text %></div>
      </article>
    <% }) %>
  <% } else { %>
    <p>No reviews yet.</p>
  <% } %>

  <% if (account && inv_id) { %>
    <form id="addReviewForm" action="/reviews/add" method="POST" class="mt-3">
      <div class="mb-2">
        <label for="screen_name" class="form-label">Screen name</label>
        <input type="text" id="screen_name" class="form-control" 
               value="<%= account.first_name ? account.first_name.charAt(0) : '' %><%= account.last_name ? account.last_name.replace(/\s+/g,'') : '' %>" readonly>
      </div>
      <div class="mb-2">
        <label for="review_text" class="form-label">Your review</label>
        <textarea id="review_text" name="review_text" rows="4" class="form-control" required></textarea>
      </div>
      <input type="hidden" name="inv_id" value="<%= inv_id %>">
      <button type="submit" class="btn btn-primary">Submit Review</button>
    </form>
  <% } else if (!account) { %>
    <p class="mt-3">You can add a review by <a href="/account/login">logging in</a>.</p>
  <% } %>
</section>